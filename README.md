## ๐ง Email Sender โ ะะฒัะพะผะฐัะธัะตัะบะฐั SMTP-ัะฐัััะปะบะฐ HTML-ะฟะธัะตะผ
๐ [ะะพัะผะพััะตัั ะฟัะพะตะบั ะฝะฐ GitHub](https://github.com/nigdanil/email_sender)

ะัะพะตะบั ะฝะฐ Go ะดะปั ะพัะฟัะฐะฒะบะธ ะฟะตััะพะฝะฐะปะธะทะธัะพะฒะฐะฝะฝัั HTML-ะฟะธัะตะผ ะฟัะตะดะฟัะธะฝะธะผะฐัะตะปัะผ ะธะท SQLite-ะฑะฐะทั ัะตัะตะท SMTP (ะฏะฝะดะตะบั ะธะปะธ ะปัะฑะพะน ะดััะณะพะน).

---

### ๐งพ ะะพะทะผะพะถะฝะพััะธ

* ะะฐะณััะทะบะฐ HTML-ัะฐะฑะปะพะฝะฐ ะฟะธััะผะฐ
* ะะพะดััะฐะฝะพะฒะบะฐ ะธะผะตะฝะธ ะธ ัััะปะบะธ ะพัะฟะธัะบะธ
* ะัะฟัะฐะฒะบะฐ ัะตัะตะท SMTP (`gomail.v2`)
* ะัะฑะพัะบะฐ ัะพะปัะบะพ ะฝัะถะฝัั ะทะฐะฟะธัะตะน (`send_email = 0`)
* ะะพะณะธัะพะฒะฐะฝะธะต ะฒ ัะฐะนะป (`logs/email_sender.log`)
* ะะฐะฝะดะพะผะฝะฐั ะทะฐะดะตัะถะบะฐ ะผะตะถะดั ะฟะธััะผะฐะผะธ
* ะัะผะตัะบะฐ ะพัะฟัะฐะฒะปะตะฝะฝัั ะฟะธัะตะผ ะฒ ะฑะฐะทะต
* ะะพะดะดะตัะถะบะฐ `.env` ะดะปั ะบะพะฝัะธะดะตะฝัะธะฐะปัะฝัั ะฝะฐัััะพะตะบ

---

### ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
email_sender/
โโโ main.go                 # ะขะพัะบะฐ ะฒัะพะดะฐ
โโโ go.mod / go.sum         # ะะฐะฒะธัะธะผะพััะธ Go
โโโ .env                    # ะะพะฝัะธะดะตะฝัะธะฐะปัะฝัะต ะฟะตัะตะผะตะฝะฝัะต
โโโ config/                 # ะะฐะณััะทะบะฐ SMTP-ะบะพะฝัะธะณะฐ
โ   โโโ config.go
โโโ db/                     # ะะฐะฑะพัะฐ ั SQLite
โ   โโโ sqlite.go
โโโ email/                  # SMTP ะธ ัะฐะฑะปะพะฝั
โ   โโโ smtp.go
โ   โโโ template.go
โโโ templates/              # HTML ัะฐะฑะปะพะฝั
โ   โโโ base.html
โ   โโโ base_old.html
โโโ data/                   # ะะฐะทะฐ SQLite
โ   โโโ potential_customers.sqlite
โโโ logs/                   # ะคะฐะนะปั ะปะพะณะพะฒ
โ   โโโ email_sender.log
```

---

### โ๏ธ ะฃััะฐะฝะพะฒะบะฐ ะธ ะทะฐะฟััะบ

#### 1. ะฃััะฐะฝะพะฒะธัั Go โฅ 1.18

#### 2. ะะปะพะฝะธัะพะฒะฐัั ัะตะฟะพะทะธัะพัะธะน

```bash
git clone https://github.com/yourname/email_sender.git
cd email_sender
```

#### 3. ะฃััะฐะฝะพะฒะธัั ะทะฐะฒะธัะธะผะพััะธ

```bash
go mod tidy
```

#### 4. ะกะพะทะดะฐัั `.env` ะฒ ะบะพัะฝะต:

```env
SMTP_FROM=info@smart-stack.ru
SMTP_USER=info@smart-stack.ru
SMTP_PASS=your_smtp_app_password
```

#### 5. ะกะพะทะดะฐัั ะปะพะณ-ะฟะฐะฟะบั (ะตัะปะธ ะฝะตั)

```bash
mkdir -p logs
```

#### 6. ะะฐะฟัััะธัั

```bash
go run .
```

---

### ๐ ะกัััะบัััะฐ ัะฐะฑะปะธัั ะฒ SQLite

```sql
CREATE TABLE individual_entrepreneur (
  id INTEGER PRIMARY KEY,
  last_name TEXT,
  first_name TEXT,
  middle_name TEXT,
  email TEXT,
  send_email INTEGER DEFAULT 0,
  last_sent TEXT,
  error TEXT
);
```

---

### ๐ ะะฐะฒะธัะธะผะพััะธ

* [`gopkg.in/gomail.v2`](https://pkg.go.dev/gopkg.in/gomail.v2) โ SMTP-ะพัะฟัะฐะฒะบะฐ
* [`github.com/joho/godotenv`](https://github.com/joho/godotenv) โ ะทะฐะณััะทะบะฐ `.env`
* [`github.com/mattn/go-sqlite3`](https://github.com/mattn/go-sqlite3) โ SQLite

---

## ๐ ะฃััะฐะฝะพะฒะบะฐ ะธ ะฐะฒัะพะผะฐัะธัะตัะบะธะน ะทะฐะฟััะบ

### โ 1. ะฃะฑะตะดะธัะตัั, ััะพ Go ัััะฐะฝะพะฒะปะตะฝ

```bash
which go
```

ะัะปะธ ะฝะต ัััะฐะฝะพะฒะปะตะฝ:

```bash
sudo apt update
sudo apt install golang-go
```

---

### โ 2. ะกะพะฑะตัะธัะต ะธัะฟะพะปะฝัะตะผัะน ัะฐะนะป

```bash
cd /email_sender
go build -o email_sender
ls -la email_sender
```

---

### โ 3. ะัะพัะตััะธััะนัะต ะฒัััะฝัั

```bash
./email_sender
```

ะัะพะฒะตัััะต, ััะพ ะฒ `logs/email_sender.log` ะฟะพัะฒะธะปะธัั ะทะฐะฟะธัะธ, ะธ ัะฐัััะปะบะฐ ัะฐะฑะพัะฐะตั.

---

### โ 4. ะะพะฑะฐะฒััะต ะฒ cron ะทะฐะฟััะบ ะฟะพ ะฑัะดะฝัะผ ะฒ 08:00 ะฟะพ ะะกะ

ะัะบัะพะนัะต crontab:

```bash
crontab -e
```

ะะพะฑะฐะฒััะต ัััะพะบั:

```
0 8 * * 1-5 /email_sender/run.sh
```

#### ๐ ะะฐััะธััะพะฒะบะฐ:

| ะะพะปะต                   | ะะฝะฐัะตะฝะธะต              |
| ---------------------- | --------------------- |
| `0`                    | ะะธะฝััะฐ (00)           |
| `8`                    | ะงะฐั (08:00)           |
| `*`                    | ะะฐะถะดัะน ะดะตะฝั           |
| `*`                    | ะะฐะถะดัะน ะผะตััั          |
| `1-5`                  | ะะพะฝะตะดะตะปัะฝะธะบ โ ะััะฝะธัะฐ |
| `/email_sender/run.sh` | ะกะบัะธะฟั ะทะฐะฟััะบะฐ        |

ะัะพะฒะตัั:

```bash
crontab -l
```

---

### โ 5. ะกะบัะธะฟั ะทะฐะฟััะบะฐ `run.sh`

```bash
#!/bin/bash
cd "$(dirname "$0")"
echo "๐ ะะฐะฟััะบ ัะฐัััะปะบะธ: $(date)" >> logs/email_sender.log
./email_sender >> logs/email_sender.log 2>&1
```

---

### โ 6. ะกะบัะธะฟั ะพััะฐะฝะพะฒะบะธ `stop.sh`

```bash
#!/bin/bash
echo "โ ะััะฐะฝะพะฒะบะฐ email_sender..."
pkill -f "./email_sender"
```

> ะะฐะฒะตััะธั ะปัะฑะพะน ะทะฐะฟััะตะฝะฝัะน ะฟัะพัะตัั email\_sender

---

### โ 7. ะกะดะตะปะฐะนัะต ัะบัะธะฟัั ะธัะฟะพะปะฝัะตะผัะผะธ

```bash
chmod +x run.sh stop.sh
```

---

### โ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ ะฝะฐ ัะตัะฒะตัะต

```
email_sender/
โโโ run.sh
โโโ stop.sh
โโโ email_sender          # ะฑะธะฝะฐัะฝะธะบ
โโโ main.go
โโโ config/
โโโ db/
โโโ email/
โโโ templates/
โโโ data/
โ   โโโ potential_customers.sqlite
โโโ logs/
โ   โโโ email_sender.log
โโโ .env
```

---

### ๐ ะัะธะผะตั ะปะพะณะพะฒ (logs/email_sender.log)

๐ ะะฐะฟััะบ ัะฐัััะปะบะธ: 2025-05-15 08:00:00
โณ ะะพะดะณะพัะพะฒะบะฐ ะฟะธััะผะฐ ะดะปั: ะะฒะฐะฝะพะฒ ะะฒะฐะฝ ะะฒะฐะฝะพะฒะธั test@example.com
โ ะะธััะผะพ ััะฟะตัะฝะพ ะพัะฟัะฐะฒะปะตะฝะพ: test@example.com
๐ ะะฐะดะตัะถะบะฐ ะฟะตัะตะด ัะปะตะดัััะตะน ะพัะฟัะฐะฒะบะพะน: 1h22m0s
๐ ะะฐัััะปะบะฐ ะทะฐะฒะตััะตะฝะฐ.

### ๐ก ะะตะบะพะผะตะฝะดะฐัะธะธ

* ะฃะฑะตะดะธัะตัั, ััะพ `.env` ะธ ะปะพะณ-ัะฐะนะปั ะดะพัััะฟะฝั ะธะท ัะพะณะพ ะถะต ะบะฐัะฐะปะพะณะฐ
* ะัะปะธ `cron` ะฝะต ะฒะธะดะธั `.env`, ัะบะฐะทัะฒะฐะนัะต ะฐะฑัะพะปััะฝัะต ะฟััะธ
* ะะต ะทะฐะฑัะฒะฐะนัะต ะฟัะพ ะปะพะณะธัะพะฒะฐะฝะธะต ะธ ะฐะฒัะพ-ัะตััะฐัั ะฒ ัะปััะฐะต ะฟะฐะดะตะฝะธั (ัะตัะตะท `systemd`, ะตัะปะธ ะฟะพััะตะฑัะตััั)
* ะะปั ะฟัะพะดะฐะบัะตะฝะฐ ะผะพะถะฝะพ ะทะฐะผะตะฝะธัั cron ะฝะฐ systemd-ัะตัะฒะธั (ะฝะฐะฟัะธะผะตั, ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ, ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ัะตััะฐััะฐ ะธ ะปะพะณะพะฒ)
